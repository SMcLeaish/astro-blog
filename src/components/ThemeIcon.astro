---
const icons = {
  sun:  `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun-icon lucide-sun"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`,
  moon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon-icon lucide-moon"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></svg>`
}
---
<button class="cursor-pointer fixed top-2 left-2 z-50" aria-label="Toggle theme" id="themeToggle">
  <div class="sun fill-current" fill-rule="evenodd" set:html={icons.sun}></div>
  <div class="moon fill-current" fill-rule="evenodd" set:html={icons.moon}></div>
</button>

<style>
#themeToggle {
  border: 0;
  background: none;
  padding: 0;
  margin: 0;
}

.sun,
.moon {
  position: relative;
}
.moon { display: none; }
.sun { display: block }
:global(.dark) .sun { display: none; }
:global(.dark) .moon { display: block; }
</style>
<script is:inline>
const themes = {
  light: "winter",
  dark: "dracula",
};

const getStoredTheme = () => {
  const storedTheme = localStorage?.getItem("theme");
  return storedTheme === "dark" || storedTheme === "light" ? storedTheme : null;
};

const getPreferredTheme = () =>
  window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";

const applyTheme = (theme) => {
  document.documentElement.classList.toggle("dark", theme === "dark");
  document.documentElement.setAttribute("data-theme", themes[theme]);
  localStorage.setItem("theme", theme);
};

const initializeTheme = () => {
  const storedTheme = getStoredTheme();
  const preferredTheme = storedTheme || getPreferredTheme();
  applyTheme(preferredTheme);
};

const handleThemeToggle = () => {
  const currentTheme = document.documentElement.classList.contains("dark")
    ? "dark"
    : "light";
  const newTheme = currentTheme === "dark" ? "light" : "dark";
  applyTheme(newTheme);
};

initializeTheme();
document
  .getElementById("themeToggle")
  ?.addEventListener("click", handleThemeToggle);
</script>
