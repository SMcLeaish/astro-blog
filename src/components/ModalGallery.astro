---
const { id, charts, titles = [] } = Astro.props;
---
<div class="flex flex-wrap gap-4 justify-center">
  {titles.map((t, i) => (
    <label for={id} class="cursor-pointer">
      <div class="w-32 h-32 bg-base-200 flex items-center justify-center rounded-lg shadow">
        <span class="text-sm">{t}</span>
      </div>
    </label>
  ))}
</div>

<input type="checkbox" id={id} class="modal-toggle" />

<div
  class="modal"
  data-charts={JSON.stringify(charts)}
>
  <div class="modal-box max-w-6xl bg-base-100 relative">
    <label for={id} class="btn btn-sm btn-circle absolute right-2 top-2">âœ•</label>

    <div class="carousel w-full rounded-lg overflow-visible">
      {charts.map((chartPath, i) => (
        <div class="carousel-item w-full justify-center" id={`chart-container-${i}`}>
          <div class="chart-placeholder" id={`chart-${i}`}></div>
        </div>
      ))}
    </div>
  </div>
</div>

<script>
  import embed from "vega-embed";

  const modal = document.querySelector(".modal[data-charts]");
  const charts = JSON.parse(modal.dataset.charts);

  charts.forEach(async (spec, i) => {
    const target = document.getElementById(`chart-${i}`);
    try {
      await embed(target, spec, { actions: false, renderer: "canvas" });
    } catch (err) {
      console.error(`Error embedding chart ${i}:`, err);
    }
  });
</script>
